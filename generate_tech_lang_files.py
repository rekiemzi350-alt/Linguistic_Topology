import os

# --- Positional Bit-Mapping for QWERTY Keys ---
# This simulates 'Bit-Velocity': faster/easier keys have shorter bit-depths.
BIT_MAP = {
    # Home Row (High Velocity / Low Bit-Depth)
    'f': '10', 'j': '11', 'd': '101', 'k': '111', 's': '011', 'l': '010', 
    'a': '1001', 'g': '1101', 'h': '1011', ';': '0011', "'": '0010',
    # Top Row (Medium Velocity)
    'r': '0001', 'u': '0101', 'e': '11001', 'i': '11110', 'w': '11111', 'o': '10001', 
    't': '10000', 'y': '01111', 'q': '011101', 'p': '011100', '[': '000011', ']': '000010',
    # Bottom Row (Lower Velocity)
    'v': '10101', 'm': '10111', 'c': '000001', 'n': '000000', 'x': '110001', 
    'b': '110000', 'z': '010101', ',': '010100', '.': '011010', '/': '011011',
    # Symbols & Modifiers (High Bit-Depth)
    ' ': '1', '\\': '111111', '|': '111110', ':': '010111', '"': '010110', 
    '{': '101010', '}': '101011', '<': '111001', '>': '111000', '-': '110111', 
    '_': '110110', '`': '000111', '~': '000110'
}

def get_bit_depth(char):
    # Returns the variable bitcode for a key. Defaults to 8-bit ASCII if not mapped.
    return BIT_MAP.get(char.lower(), format(ord(char), '08b'))

# --- Native Script Mappings (as previously defined) ---
MAPPINGS = {
    "russian": {
        'й':'q','ц':'w','у':'e','к':'r','е':'t','н':'y','г':'u','ш':'i','щ':'o','з':'p','х':'[','ъ':']',
        'ф':'a','ы':'s','в':'d','а':'f','п':'g','р':'h','о':'j','л':'k','д':'l','ж':';','э':"'",
        'я':'z','ч':'x','с':'c','м':'v','и':'b','т':'n','ь':'m','б':',','ю':'.','.':'/','ё':'`'
    },
    "belorussian": {
        'й':'q','ц':'w','у':'e','к':'r','е':'t','н':'y','г':'u','ш':'i','щ':'o','з':'p','х':'[','' :']',
        'ф':'a','ы':'s','в':'d','а':'f','п':'g','р':'h','о':'j','л':'k','д':'l','ж':';','э':"'",
        'я':'z','ч':'x','с':'c','м':'v','і':'s','т':'n','ь':'m','б':',','ю':'.','.':'/','ў':'`','' : ']'
    },
    "ukrainian": {
        'й':'q','ц':'w','у':'e','к':'r','е':'t','н':'y','г':'u','ш':'i','щ':'o','з':'p','х':'[','ї':']',
        'ф':'a','і':'s','в':'d','а':'f','п':'g','р':'h','о':'j','л':'k','д':'l','ж':';','є':"'",
        'я':'z','ч':'x','с':'c','м':'v','и':'b','т':'n','ь':'m','б':',','ю':'.','.':'/','ґ':'`'
    },
    "bulgarian": {
        'й':'q','ц':'w','у':'e','к':'r','е':'t','н':'y','г':'u','ш':'i','щ':'o','з':'p','х':'[','ъ':']',
        'ф':'a','ы':'s','в':'d','а':'f','п':'g','р':'h','о':'j','л':'k','д':'l','ж':';','э':"'",
        'я':'z','ч':'x','с':'c','м':'v','и':'b','т':'n','ь':'m','б':',','ю':'.','.':'/'
    },
    "macedonian": {
        'љ':'q','њ':'w','е':'e','р':'r','т':'t','з':'y','у':'u','и':'i','о':'o','п':'p','ш':'[','ѓ':']',
        'а':'a','с':'s','д':'d','ф':'f','г':'g','х':'h','ј':'j','к':'k','л':'l','ч':';','ќ':"'",
        'з':'z','џ':'x','ц':'c','в':'v','б':'b','н':'n','м':'m',',':',','.':'.','ѕ':'/'
    },
    "greek": {
        'α':'a','β':'v','γ':'g','δ':'d','ε':'e','ζ':'z','η':'h','θ':'u','ι':'i','κ':'k','λ':'l','μ':'m',
        'ν':'n','ξ':'j','ο':'o','π':'p','ρ':'r','σ':'s','τ':'t','υ':'y','φ':'f','χ':'x','ψ':'c','ω':'v',
        'ς':'w','ά':'a','έ':'e','ή':'h','ί':'i','ό':'o','ύ':'y','ώ':'v'
    },
    "attic greek": {
        'α':'a','β':'v','γ':'g','δ':'d','ε':'e','ζ':'z','η':'h','θ':'u','ι':'i','κ':'k','λ':'l','μ':'m',
        'ν':'n','ξ':'j','ο':'o','π':'p','ρ':'r','σ':'s','τ':'t','υ':'y','φ':'f','χ':'x','ψ':'c','ω':'v',
        'ς':'w','ά':'a','έ':'e','ή':'h','ί':'i','ό':'o','ύ':'y','ώ':'v'
    },
    "ionic greek": {
        'α':'a','β':'v','γ':'g','δ':'d','ε':'e','ζ':'z','η':'h','θ':'u','ι':'i','κ':'k','λ':'l','μ':'m',
        'ν':'n','ξ':'j','ο':'o','π':'p','ρ':'r','σ':'s','τ':'t','υ':'y','φ':'f','χ':'x','ψ':'c','ω':'v',
        'ς':'w','ά':'a','έ':'e','ή':'h','ί':'i','ό':'o','ύ':'y','ώ':'v'
    },
    "doric greek": {
        'α':'a','β':'v','γ':'g','δ':'d','ε':'e','ζ':'z','η':'h','θ':'u','ι':'i','κ':'k','λ':'l','μ':'m',
        'ν':'n','ξ':'j','ο':'o','π':'p','ρ':'r','σ':'s','τ':'t','υ':'y','φ':'f','χ':'x','ψ':'c','ω':'v',
        'ς':'w','ά':'a','έ':'e','ή':'h','ί':'i','ό':'o','ύ':'y','ώ':'v','ϝ':'v'
    },
    "koine greek": {
        'α':'a','β':'v','γ':'g','δ':'d','ε':'e','ζ':'z','η':'h','θ':'u','ι':'i','κ':'k','λ':'l','μ':'m',
        'ν':'n','ξ':'j','ο':'o','π':'p','ρ':'r','σ':'s','τ':'t','υ':'y','φ':'f','χ':'x','ψ':'c','ω':'v',
        'ς':'w','ά':'a','έ':'e','ή':'h','ί':'i','ό':'o','ύ':'y','ώ':'v'
    },
    "hebrew": {
        '/' : 'q', 'ק' : 'e', 'ר' : 'r', 'א' : 't', 'ט' : 'y', 'ו' : 'u', 'ן' : 'i', 'ם' : 'o', 'פ' : 'p',
        'ש' : 'a', 'ד' : 's', 'ג' : 'd', 'כ' : 'f', 'ע' : 'g', 'י' : 'h', 'ח' : 'j', 'ל' : 'k', 'ך' : 'l', 'ף' : ';', ',': "'",
        'ז' : 'z', 'ס' : 'x', 'ב' : 'c', 'ה' : 'v', 'נ' : 'b', 'מ' : 'n', 'צ' : 'm', 'ת' : ',', 'ץ' : '.', '.': '/'
    },
    "arabic": {
        'ض':'q','ص':'w','ث':'e','ق':'r','ف':'t','غ':'y','ع':'u','ه':'i','خ':'o','ح':'p','ج':'[','د':']',
        'ش':'a','س':'s','ي':'d','ب':'f','ل':'g','ا':'h','ت':'j','н':'k','م':'l','ك':';','ط':"'",
        'ئ':'z','ء':'x','ؤ':'c','ر':'v','لا':'b','ى':'n','ة':'m','و':',','ز':'.','ظ':'/'
    },
    "korean": {
        'ㅂ':'q','ㅈ':'w','ㄷ':'e','ㄱ':'r','ㅅ':'t','ㅛ':'y','ㅕ':'u','ㅑ':'i','ㅐ':'o','ㅔ':'p',
        'ㅁ':'a','ㄴ':'s','ㅇ':'d','ㄹ':'f','ㅎ':'g','ㅗ':'h','ㅓ':'j','ㅏ':'k','ㅣ':'l',
        'ㅋ':'z','ㅌ':'x','ㅊ':'c','ㅍ':'v','ㅠ':'b','ㅜ':'n','ㅡ':'m',
        'ㅃ':'Q','ㅉ':'W','ㄸ':'E','ㄲ':'R','ㅆ':'T','ㅒ':'O','ㅖ':'P'
    },
    "german": { 'z':'y', 'y':'z', 'ä':"'", 'ö':';', 'ü':'[', 'ß':'-' },
    "french": { 'a':'q', 'q':'a', 'z':'w', 'w':'z', 'm':';', 'ù':"'", '^':'[', '$':']' },
    "spanish": { 'ñ':';', 'Ñ':':', '´':"'", 'ç':'\\', 'Ç':'|', '+':']' },
    "italian": { 'ù':'\\', 'à':"'", 'ò':';', 'è':'[', 'é':'{', '+':']', '*': '}' },
    "turkish": { 'ı':'i', 'i':"'", 'ş':';', 'ğ':'[', 'ü':']', 'ç':'.', 'ö':',' },
    # --- New Mappings for Massive Add ---
    "armenian": { # For both Eastern and Western
        'ա':'a', 'բ':'b', 'գ':'g', 'դ':'d', 'ե':'e', 'զ':'z', 'է':'e', 'ը':'y', 'թ':'t', 'ժ':'j',
        'ի':'i', 'լ':'l', 'խ':'x', 'ծ':'c', 'կ':'k', 'հ':'h', 'ձ':'d', 'ղ':'g', 'ճ':'c', 'մ':'m',
        'յ':'y', 'ն':'n', 'շ':'s', 'ո':'o', 'չ':'c', 'պ':'p', 'ջ':'j', 'ռ':'r', 'ս':'s', 'վ':'v',
        'տ':'t', 'ր':'r', 'ց':'c', 'ւ':'w', 'փ':'p', 'ք':'q', 'օ':'o', 'ֆ':'f',
        'և':'ev'
    },
    "georgian": {
        'ა':'a', 'ბ':'b', 'გ':'g', 'დ':'d', 'ე':'e', 'ვ':'v', 'ზ':'z', 'თ':'t', 'ი':'i', 'კ':'k',
        'ლ':'l', 'მ':'m', 'ნ':'n', 'ო':'o', 'პ':'p', 'ჟ':'j', 'რ':'r', 'ს':'s', 'ტ':'t', 'უ':'u',
        'ფ':'p', 'ქ':'k', 'ღ':'g', 'ყ':'y', 'შ':'s', 'ჩ':'c', 'ც':'c', 'ძ':'d', 'წ':'w', 'ჭ':'c',
        'ხ':'x', 'ჯ':'j', 'ჰ':'h'
    },
    "devanagari": { # Hindi, Marathi, Nepali, Sanskrit
        'अ':'a', 'आ':'aa', 'इ':'i', 'ई':'ee', 'उ':'u', 'ऊ':'oo', 'ऋ':'ri', 'ए':'e', 'ऐ':'ai', 'ओ':'o', 'औ':'au',
        'क':'k', 'ख':'kh', 'ग':'g', 'घ':'gh', 'ङ':'ng', 'च':'ch', 'छ':'chh', 'ज':'j', 'झ':'jh', 'ञ':'ny',
        'ट':'t', 'ठ':'th', 'ड':'d', 'ढ':'dh', 'ण':'n', 'त':'t', 'थ':'th', 'द':'d', 'ध':'dh', 'न':'n',
        'प':'p', 'फ':'ph', 'ब':'b', 'भ':'bh', 'म':'m', 'य':'y', 'र':'r', 'ल':'l', 'व':'v', 'श':'sh',
        'ष':'sh', 'स':'s', 'ह':'h', 'क्ष':'ksh', 'त्र':'tr', 'ज्ञ':'gy',
        'ा':'a', 'ि':'i', 'ी':'ee', 'ु':'u', 'ू':'oo', 'ृ':'ri', 'े':'e', 'ै':'ai', 'ो':'o', 'ौ':'au', 'ं':'n', 'ः':'h'
    },
    "bengali": {
        'অ':'o', 'আ':'a', 'ই':'i', 'ঈ':'i', 'উ':'u', 'ঊ':'u', 'ঋ':'ri', 'এ':'e', 'ঐ':'oi', 'ও':'o', 'ঔ':'ou',
        'ক':'k', 'খ':'kh', 'গ':'g', 'ঘ':'gh', 'ঙ':'ng', 'চ':'c', 'ছ':'ch', 'জ':'j', 'ঝ':'jh', 'ঞ':'n',
        'ট':'t', 'ঠ':'th', 'ড':'d', 'ঢ':'dh', 'ণ':'n', 'ত':'t', 'থ':'th', 'দ':'d', 'ध':'dh', 'ন':'n',
        'প':'p', 'ফ':'ph', 'ব':'b', 'ভ':'bh', 'ম':'m', 'য':'j', 'র':'r', 'ল':'l', 'শ':'sh', 'ষ':'ss',
        'স':'s', 'হ':'h', 'য়':'y', 'ড়':'r', 'ঢ়':'rh', 'ৎ':'t', 'ং':'n', 'ঃ':'h', 'ঁ':'n'
    },
    "gujarati": {
        'અ':'a', 'આ':'a', 'ઇ':'i', 'ઈ':'i', 'ઉ':'u', 'ઊ':'u', 'ઋ':'ru', 'એ':'e', 'ઐ':'ai', 'ઓ':'o', 'ઔ':'au',
        'ક':'k', 'ખ':'kh', 'ગ':'g', 'ઘ':'gh', 'ચ':'ch', 'છ':'chh', 'જ':'j', 'ઝ':'jh', 'ટ':'t', 'ઠ':'th',
        'ડ':'d', 'ઢ':'dh', 'ણ':'n', 'ત':'t', 'થ':'th', 'દ':'d', 'ધ':'dh', 'ન':'n', 'પ':'p', 'ફ':'f',
        'બ':'b', 'ભ':'bh', 'મ':'m', 'ય':'y', 'ર':'r', 'લ':'l', 'વ':'v', 'શ':'sh', 'ષ':'sh', 'સ':'s',
        'હ':'h', 'ળ':'l'
    },
    "gurmukhi": { # Punjabi
        'ਕ':'k', 'ਖ':'kh', 'ਗ':'g', 'ਘ':'gh', 'ਚ':'c', 'ਛ':'ch', 'ਜ':'j', 'ਝ':'jh', 'ਟ':'t', 'ਠ':'th',
        'ਡ':'d', 'ਢ':'dh', 'ਣ':'n', 'ਤ':'t', 'ਥ':'th', 'ਦ':'d', 'ਧ':'dh', 'ਨ':'n', 'ਪ':'p', 'ਫ':'ph',
        'ਬ':'b', 'ਭ':'bh', 'ਮ':'m', 'ਯ':'y', 'ਰ':'r', 'ਲ':'l', 'ਵ':'v', 'ੜ':'r', 'ਸ':'s', 'ਹ':'h'
    },
    "kannada": {
        'ಅ':'a', 'ಆ':'aa', 'ಇ':'i', 'ಈ':'ee', 'ಉ':'u', 'ಊ':'oo', 'ಋ':'ru', 'ಎ':'e', 'ಏ':'ee', 'ಐ':'ai', 'ಒ':'o', 'ಓ':'oo', 'ಔ':'au',
        'ಕ':'k', 'ಖ':'kh', 'ಗ':'g', 'ಘ':'gh', 'ಙ':'ng', 'ಚ':'ch', 'ಛ':'chh', 'ಜ':'j', 'ಝ':'jh', 'ಞ':'ny',
        'ಟ':'t', 'ಠ':'th', 'ಡ':'d', 'ಢ':'dh', 'ಣ':'n', 'ತ':'t', 'ಥ':'th', 'ದ':'d', 'ಧ':'dh', 'ನ':'n',
        'ಪ':'p', 'ಫ':'ph', 'ಬ':'b', 'ಭ':'bh', 'ಮ':'m', 'ಯ':'y', 'ರ':'r', 'ಲ':'l', 'ವ':'v', 'ಶ':'sh', 'ಷ':'sh', 'ಸ':'s', 'ಹ':'h', 'ಳ':'l'
    },
    "tamil": {
        'க':'k', 'ங':'n', 'ச':'s', 'ஞ':'n', 'ட':'t', 'ண':'n', 'த':'t', 'ந':'n', 'ப':'p', 'ம':'m',
        'ய':'y', 'ர':'r', 'ல':'l', 'வ':'v', 'ழ':'l', 'ள':'l', 'ற':'r', 'ன':'n', 'ஜ':'j', 'ஷ':'sh',
        'ஸ':'s', 'ஹ':'h', 'க்ஷ':'ksh', 'ஸ்ரீ':'sri'
    },
    "telugu": {
        'అ':'a', 'ఆ':'aa', 'ఇ':'i', 'ఈ':'ee', 'ఉ':'u', 'ఊ':'oo', 'ఋ':'ru', 'ఎ':'e', 'ఏ':'ee', 'ఐ':'ai', 'ఒ':'o', 'ఓ':'oo', 'ఔ':'au',
        'క':'k', 'ఖ':'kh', 'గ':'g', 'ఘ':'gh', 'చ':'ch', 'ఛ':'chh', 'జ':'j', 'ఝ':'jh', 'ట':'t', 'ఠ':'th',
        'డ':'d', 'ఢ':'dh', 'ణ':'n', 'త':'t', 'థ':'th', 'ద':'d', 'ధ':'dh', 'న':'n', 'ప':'p', 'ఫ':'ph',
        'బ':'b', 'భ':'bh', 'మ':'m', 'య':'y', 'ర':'r', 'ల':'l', 'వ':'v', 'శ':'sh', 'ష':'sh', 'స':'s', 'హ':'h'
    },
    "thai": {
        'ก':'k', 'ข':'kh', 'ฃ':'kh', 'ค':'kh', 'ฅ':'kh', 'ฆ':'kh', 'ง':'ng', 'จ':'ch', 'ฉ':'ch', 'ช':'ch', 'ซ':'s',
        'ฌ':'ch', 'ญ':'y', 'ฎ':'d', 'ฏ':'t', 'ฐ':'th', 'ฑ':'th', 'ฒ':'th', 'ณ':'n', 'ด':'d', 'ต':'t', 'ถ':'th',
        'ท':'th', 'ธ':'th', 'น':'n', 'บ':'b', 'ป':'p', 'ผ':'ph', 'ฝ':'f', 'พ':'ph', 'ฟ':'f', 'ภ':'ph', 'ม':'m',
        'ย':'y', 'ร':'r', 'ล':'l', 'ว':'w', 'ศ':'s', 'ษ':'s', 'ส':'s', 'ห':'h', 'ฬ':'l', 'อ':'', 'ฮ':'h',
        'ะ':'a', 'ั':'a', 'า':'a', 'ำ':'am', 'ิ':'i', 'ี':'i', 'ึ':'ue', 'ื':'ue', 'ุ':'u', 'ู':'u', 'เ':'e', 'แ':'ae',
        'โ':'o', 'ใ':'ai', 'ไ':'ai'
    },
    "lao": {
        'ກ':'k', 'ຂ':'kh', 'ຄ':'kh', 'ງ':'ng', 'ຈ':'ch', 'ສ':'s', 'ຊ':'s', 'ຍ':'y', 'ດ':'d', 'ຕ':'t', 'ຖ':'th',
        'ທ':'th', 'ນ':'n', 'ບ':'b', 'ປ':'p', 'ຜ':'ph', 'ຝ':'f', 'ພ':'ph', 'ຟ':'f', 'ມ':'m', 'ຢ':'y', 'ຣ':'r',
        'ລ':'l', 'ວ':'w', 'ຫ':'h', 'ອ':'o', 'ຮ':'h'
    },
    "burmese": {
        'က':'k', 'ခ':'kh', 'ဂ':'g', 'ဃ':'g', 'င':'ng', 'စ':'s', 'ဆ':'s', 'ဇ':'z', 'ဈ':'z', 'ည':'ny',
        'ဋ':'t', 'ဌ':'ht', 'ဍ':'d', 'ฒ':'d', 'ဏ':'n', 'တ':'t', 'ထ':'ht', 'ဒ':'d', 'ဓ':'d', 'န':'n',
        'ပ':'p', 'ဖ':'ph', 'ဗ':'b', 'ဘ':'b', 'မ':'m', 'ယ':'y', 'ရ':'y', 'လ':'l', 'ဝ':'w', 'သ':'th',
        'ဟ':'h', 'ဠ':'l', 'အ':'a'
    },
    "khmer": {
        'ក':'k', 'ខ':'kh', 'គ':'k', 'ឃ':'kh', 'ង':'ng', 'ច':'ch', 'ឆ':'chh', 'ជ':'ch', 'ឈ':'chh', 'ញ':'nh',
        'ដ':'d', 'ឋ':'th', 'ឌ':'d', 'ឍ':'th', 'ណ':'n', 'ត':'t', 'ថ':'th', 'ទ':'t', 'ធ':'th', 'ន':'n',
        'ប':'b', 'ផ':'ph', 'ព':'p', 'ភ':'ph', 'ម':'m', 'យ':'y', 'រ':'r', 'ល':'l', 'វ':'v', 'ស':'s',
        'ហ':'h', 'ឡ':'l', 'អ':'a'
    },
    "amharic": { # and Tigrinya
        'ሀ':'h', 'ለ':'l', 'ሐ':'h', 'መ':'m', 'ሠ':'s', 'ረ':'r', 'ሰ':'s', 'ሸ':'sh', 'ቀ':'q', 'በ':'b',
        'ተ':'t', 'ቸ':'ch', 'ኀ':'h', 'ነ':'n', 'ኘ':'ny', 'አ':'a', 'ከ':'k', 'ኸ':'kh', 'ወ':'w', 'ዐ':'a',
        'ዘ':'z', 'ዠ':'zh', 'የ':'y', 'ደ':'d', 'ጀ':'j', 'ገ':'g', 'ጠ':'t', 'ጨ':'ch', 'ጰ':'p', 'ጸ':'ts',
        'ፀ':'ts', 'ፈ':'f', 'ፐ':'p'
    },
    "braille": {
        '⠁':'1', '⠃':'2', '⠉':'3', '⠙':'4', '⠑':'5', '⠋':'6', '⠛':'7', '⠓':'8', '⠊':'9', '⠚':'0', '⠼':''
    }
}

# Add aliases to MAPPINGS
MAPPINGS["armenian (eastern)"] = MAPPINGS["armenian"]
MAPPINGS["armenian (western)"] = MAPPINGS["armenian"]
MAPPINGS["hindi"] = MAPPINGS["devanagari"]
MAPPINGS["marathi"] = MAPPINGS["devanagari"]
MAPPINGS["nepali"] = MAPPINGS["devanagari"]
MAPPINGS["punjabi"] = MAPPINGS["gurmukhi"]
MAPPINGS["tigrinya"] = MAPPINGS["amharic"]
MAPPINGS["greek"] = MAPPINGS["greek"]


def process_lang_file(filepath):
    tech_filepath = filepath.replace(".lang", "TECH.lang")
    lines = []
    name = ""
    with open(filepath, 'r', encoding='utf-8') as f:
        file_content = f.readlines()
        
    for line in file_content:
        if line.strip().startswith('name:'):
            name = line.split(':', 1)[1].strip()
            lines.append(f"name: {name} (TECH)\n")
            continue
        
        if ':' in line and not line.startswith('#'):
            parts = line.split(':', 1)
            key = parts[0].strip()
            val = parts[1].strip()
            
            if key.isdigit() or key in ["hundred", "ten_sep", "hundred_sep"]:
                # 1. Native -> QWERTY Key
                qwerty_word = "".join(MAPPINGS.get(name.lower(), {}).get(c, c) for c in val)
                # 2. QWERTY Key -> Variable Bitcode
                bitcode = "".join(get_bit_depth(c) for c in qwerty_word)
                lines.append(f"{key}: {bitcode}\n")
            else:
                lines.append(line)
        else:
            lines.append(line)

    with open(tech_filepath, 'w', encoding='utf-8') as f:
        f.writelines(lines)
    print(f"Generated: {tech_filepath}")

if __name__ == "__main__":
    for file in os.listdir('.'):
        if file.endswith('.lang') and "TECH" not in file:
            process_lang_file(file)